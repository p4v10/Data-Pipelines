service: rss-feed-reader
frameworkVersion: '3'

provider:
  name: aws
  runtime: python3.11
  region: us-east-1
  stage: dev

custom:
  stage: ${opt:stage, self:provider.stage}

functions:
  get-feed-and-article:
    handler: lambda-get-feed.lambda_handler
    # Specify the path to your Lambda function code
    package:
      include:
        - feed_parser_lambda_package/lambda-get-feed.py
        - requirements.txt  # Include the requirements.txt file
    environment:  # Add any environment variables here if needed
      VARIABLE_NAME: variable_value

plugins:
  - serverless-python-requirements  # Plugin to bundle Python dependencies

resources:
  Resources:
    RssFeedSourceTable:
      Type: 'AWS::DynamoDB::Table'
      Properties:
        TableName: ${self:service}-source-db-${self:custom.stage}
        AttributeDefinitions:
          - AttributeName: feed_id
            AttributeType: N
          - AttributeName: date_added
            AttributeType: S
        KeySchema:
          - AttributeName: feed_id
            KeyType: HASH
          - AttributeName: date_added
            KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 5
          WriteCapacityUnits: 5